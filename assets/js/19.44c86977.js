(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{525:function(e,t,s){"use strict";s.r(t);var a=s(6),n=Object(a.a)({},(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("p",[e._v("In a novice-oriented article, I will give a brief introduction to AWS SQS.")]),e._v(" "),s("h1",{attrs:{id:"what-is-aws-sqs"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#what-is-aws-sqs"}},[e._v("#")]),e._v(" What is AWS SQS?")]),e._v(" "),s("p",[e._v('"'),s("em",[e._v("Amazon Simple Queue Service (SQS) is a fully managed message queuing service.")]),e._v('"\nTo use SQS, you need to remember the following points:')]),e._v(" "),s("ul",[s("li",[e._v("SQS is fully managed by AWS, and you don't need to worry about maintaining it.")]),e._v(" "),s("li",[e._v("SQS is a SIMPLE queue service whose mechanism is simple, and it doesn't provide complex operations like RabbitMQ, Kafka, etc.")]),e._v(" "),s("li",[e._v("SQS offers two types of message queues:\n"),s("ul",[s("li",[e._v("Standard queue: at-least-once delivery, so you need to handle Idempotent logic in the application. The throughput is super high.")]),e._v(" "),s("li",[e._v("FIFO: provides exactly once delivery, keep the exact order. But it sacrifices its throughput.")])])])]),e._v(" "),s("p",[e._v("In the most use case, we choose standard queue for its performance and solve the Idempotent and order issue by ourselves.")]),e._v(" "),s("h1",{attrs:{id:"terminology"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#terminology"}},[e._v("#")]),e._v(" Terminology")]),e._v(" "),s("p",[e._v("The most important terminology is the visibility which confused a lot of novices.")]),e._v(" "),s("h2",{attrs:{id:"visibility-timeout"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#visibility-timeout"}},[e._v("#")]),e._v(" Visibility Timeout")]),e._v(" "),s("p",[e._v("If a message is not visible, it is not able to be fetched. The message is not receivable within its visibility timeout.  If the message is invisible, we could see it as a part of the in-flight message's count.")]),e._v(" "),s("p",[e._v("Visibility timeout is usually a good mechanism to act as message retry timeout. When we failed to process messages and we don't want to retry it immediately, we could change message visibility timeout and then the message will not be fetched by our application during the timeout. With this way, we relief the retry logic from our application, utilize SQS to handle it instead.")]),e._v(" "),s("h2",{attrs:{id:"dead-letter-queue-dlq"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#dead-letter-queue-dlq"}},[e._v("#")]),e._v(" Dead-Letter Queue (DLQ)")]),e._v(" "),s("p",[e._v("Let's say we have a queue Q1 as our task queue, and we set up another queue Q2 as the DLQ of Q1. When messages in Q1 are put back to the queue beyond the maximum retry times (based on our configuration), the message will be deleted from Q1 and moved to Q2.\nDLQ's nature is still an SQS queue, but it serves as a bin box for us. We move messages to DLQ when it continually failed to process and we don't want throw the message and may want to check the message manually after.\nTo avoid failed messages block our standard processing, DLQ is always recommended.")]),e._v(" "),s("h1",{attrs:{id:"how-it-works"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#how-it-works"}},[e._v("#")]),e._v(" How it works?")]),e._v(" "),s("p",[e._v("SQS works like other message queues.")]),e._v(" "),s("ul",[s("li",[e._v("Publisher sends messages to SQS. You could set a wait timeout, then the subscriber is only able to receive the message after the timeout")]),e._v(" "),s("li",[e._v("Subscriber receives messages by long polling. With the configuration, each polling could get at most 10 message in batch.")]),e._v(" "),s("li",[e._v("Even the subscriber receives messages, the messages will not be deleted from SQS. To delete messages, you have to call the delete function explicitly.")])]),e._v(" "),s("p",[s("img",{attrs:{src:"https://raw.githubusercontent.com/y4h2/y4h2.github.io/imagebed/img/blog/20210326211416.png",alt:""}})]),e._v(" "),s("h2",{attrs:{id:"sample-code"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#sample-code"}},[e._v("#")]),e._v(" Sample Code")]),e._v(" "),s("p",[e._v("Check the official example directly: "),s("a",{attrs:{href:"https://docs.aws.amazon.com/sdk-for-go/v1/developer-guide/using-sqs-with-go-sdk.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://docs.aws.amazon.com/sdk-for-go/v1/developer-guide/using-sqs-with-go-sdk.html"),s("OutboundLink")],1)]),e._v(" "),s("h1",{attrs:{id:"metrics"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#metrics"}},[e._v("#")]),e._v(" Metrics")]),e._v(" "),s("p",[e._v("For more details, check "),s("a",{attrs:{href:"https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/sqs-available-cloudwatch-metrics.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/sqs-available-cloudwatch-metrics.html"),s("OutboundLink")],1),e._v("\nAlthough we don't need to maintain SQS, we still need to monitor its metrics to check whether applications are running correctly.")]),e._v(" "),s("p",[e._v("Approximate Age Of Oldest Message\nThe approximate age of the oldest non-deleted message in the queue. It could reflect the maximum delay of our procession.")]),e._v(" "),s("p",[e._v("Number Of Empty Receives\nWhen subscribers poll messages, if it fetches no message, the operation will be marked as empty receives.")]),e._v(" "),s("p",[e._v('Number Of Messages Deleted\nWhen you receive a message from SQS, the message is still remaining in the queue until you actively call the "delete message" function. As regard to the example scenario, it reflects the actual processing speed of the application.')]),e._v(" "),s("h1",{attrs:{id:"lambda-integration"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#lambda-integration"}},[e._v("#")]),e._v(" Lambda Integration")]),e._v(" "),s("p",[e._v("AWS Lambda supports AWS SQS as an event source, when SQS receives messages, it will trigger the attached Lambda function.\nBetween SQS and Lambda, there is an integration layer. When SQS gets new messages, the integration layer will trigger lambda to execute.")]),e._v(" "),s("ul",[s("li",[e._v("If the lambda handler returns nil, the message will be deleted from SQS")]),e._v(" "),s("li",[e._v("If the lambda handler returns errors, the message will be put back to the queue with the default visibility timeout (you cannot change it dynamically)")]),e._v(" "),s("li",[e._v("If DLQ has been set up, after a number of retries, the message will be deleted from the original queue and sent to the DLQ.")])]),e._v(" "),s("p",[e._v("If you check the lambda handler's signature "),s("code",[e._v("func handler(ctx context.Context, sqsEvent events.SQSEvent) error")]),e._v(", everything is inside the event. With this event, you are not able to use SQS SDK like in other applications.")]),e._v(" "),s("div",{staticClass:"language-go line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-go"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("package")]),e._v(" events\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("type")]),e._v(" SQSEvent "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("struct")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n\tRecords "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("SQSMessage "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('`json:"Records"`')]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("type")]),e._v(" SQSMessage "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("struct")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n\tMessageId              "),s("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("string")]),e._v("                         "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('`json:"messageId"`')]),e._v("\n\tReceiptHandle          "),s("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("string")]),e._v("                         "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('`json:"receiptHandle"`')]),e._v("\n\tBody                   "),s("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("string")]),e._v("                         "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('`json:"body"`')]),e._v("\n\tMd5OfBody              "),s("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("string")]),e._v("                         "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('`json:"md5OfBody"`')]),e._v("\n\tMd5OfMessageAttributes "),s("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("string")]),e._v("                         "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('`json:"md5OfMessageAttributes"`')]),e._v("\n\tAttributes             "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("map")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("string")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("string")]),e._v("              "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('`json:"attributes"`')]),e._v("\n\tMessageAttributes      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("map")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("string")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("SQSMessageAttribute "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('`json:"messageAttributes"`')]),e._v("\n\tEventSourceARN         "),s("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("string")]),e._v("                         "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('`json:"eventSourceARN"`')]),e._v("\n\tEventSource            "),s("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("string")]),e._v("                         "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('`json:"eventSource"`')]),e._v("\n\tAWSRegion              "),s("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("string")]),e._v("                         "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('`json:"awsRegion"`')]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("type")]),e._v(" SQSMessageAttribute "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("struct")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n\tStringValue      "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("string")]),e._v("  "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('`json:"stringValue,omitempty"`')]),e._v("\n\tBinaryValue      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("byte")]),e._v("   "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('`json:"binaryValue,omitempty"`')]),e._v("\n\tStringListValues "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("string")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('`json:"stringListValues"`')]),e._v("\n\tBinaryListValues "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("byte")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('`json:"binaryListValues"`')]),e._v("\n\tDataType         "),s("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("string")]),e._v("   "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('`json:"dataType"`')]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br"),s("span",{staticClass:"line-number"},[e._v("11")]),s("br"),s("span",{staticClass:"line-number"},[e._v("12")]),s("br"),s("span",{staticClass:"line-number"},[e._v("13")]),s("br"),s("span",{staticClass:"line-number"},[e._v("14")]),s("br"),s("span",{staticClass:"line-number"},[e._v("15")]),s("br"),s("span",{staticClass:"line-number"},[e._v("16")]),s("br"),s("span",{staticClass:"line-number"},[e._v("17")]),s("br"),s("span",{staticClass:"line-number"},[e._v("18")]),s("br"),s("span",{staticClass:"line-number"},[e._v("19")]),s("br"),s("span",{staticClass:"line-number"},[e._v("20")]),s("br"),s("span",{staticClass:"line-number"},[e._v("21")]),s("br"),s("span",{staticClass:"line-number"},[e._v("22")]),s("br"),s("span",{staticClass:"line-number"},[e._v("23")]),s("br"),s("span",{staticClass:"line-number"},[e._v("24")]),s("br"),s("span",{staticClass:"line-number"},[e._v("25")]),s("br"),s("span",{staticClass:"line-number"},[e._v("26")]),s("br")])]),s("p",[e._v("The integration layer simplifies the logic of controlling SQS messages, but it doesn't give you more capability to handle the SQS messages.")]),e._v(" "),s("h1",{attrs:{id:"conclusion"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#conclusion"}},[e._v("#")]),e._v(" Conclusion")]),e._v(" "),s("p",[e._v("All the above sections are what we need to know about the basic usage of SQS.")])])}),[],!1,null,null,null);t.default=n.exports}}]);